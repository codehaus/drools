\chapter{Drools Rule Language}
\label{drl}

\section{Introduction}

The Drools Rule Language\index{Drools rule language} (DRL) is an XML-based
language that uses an extensible tag mechanism.  The available tags
can be extended through the use of \emph{semantic modules}.
By itself the DRL is not fully usable.  At least one semantic module
must be selected and used.  What follows is a reference for the
available core DRL tags.

\section{Core DRL namespace}

The core DRL tags belong to the \verb|http://drools.org/rules|
namespace.  In order to use the tags, the root tag must include
an \verb|xmlns| declaration binding the DRL namespace to either
a prefix (Figure \ref{drl.namespace.prefix}) or as the default namespace
(Figure \ref{drl.namespace.default}).  Common practice is to bind the
DRL namespace URI to the default namespace upon the root
\tag{<rule-set>} tag of a document.

\begin{figure}[hb]
\begin{tagExample}
<drl:rule-set \color{black}{xmlns:drl="http://drools.org/rules"}>
\end{tagExample}
\caption{Binding the DRL namespace URI to a prefix}
\label{drl.namespace.prefix}
\end{figure}

\begin{figure}[hb]
\begin{tagExample}
<rule-set \color{black}{xmlns="http://drools.org/rules"}>
\end{tagExample}
\caption{Binding the DRL namespace URI as the default namespace}
\label{drl.namespace.default}
\end{figure}

\section{Core DRL tags}

%%
%%  rule-set
%%

\subsection{\indexTag{<rule-set>}}

The root tag of a DRL document is the \tag{<rule-set>} tag, which
serves to collect a group of rules. A rule-set must have a
\texttt{name} attribute defining its name.

\begin{tagDesc}{rule-set}
\attrs
\attr{name}{Name of the rule-set.}
\tags
\childTag{rule}{One or more rule members of the set.}
\end{tagDesc}

\begin{center}
\begin{minipage}{0.8\textwidth}
\begin{tagExample}
\color{black}{<rule-set xmlns="http://drools.org/rules"}
          \color{black}{name="My First Rule Set">}
    ...
\color{black}{</rule-set>}
\end{tagExample}
\end{minipage}
\end{center}

%%
%%  rule
%%

\subsection{\indexTag{<rule>}}

A \tag{<rule>} tag defines a single rule within the rule-set.  A rule
must have at least one parameter\footnote{Semantic modules may add
implicit parameters to rules, so it's not strictly true that each
\tag{<rule>} must have a \tag{<parameter>} or a \tag{<consequence>}}.
A rule contains conditions, extractors and exactly one consequence. 

\begin{tagDesc}{rule}
\attrs
  \attr{name}{Name of the rule.}
  \attr{salience}{Optional rule salience/priority.}
\tags
  \childTag{parameter}{Parameter declaration.}
  \childTag{declaration}{Additional local declaration.}
  \abstractChildTag{condition}{Semantic condition.}
  \abstractChildTag{extractor}{Semantic extractor.}
  \abstractChildTag{consequence}{Semantic consequence.}
  \childTag{duration}{Truthness duration.}
\end{tagDesc}

\begin{center}
\begin{minipage}{0.8\textwidth}
\begin{tagExample}
<rule-set xmlns="http://drools.org/rules" 
          name="My First Rule Set">

    \color{black}{<rule name="My First Rule"}
          \color{black}{salience="10">}
        ...
    \color{black}{</rule>}

</rule-set>
\end{tagExample}
\end{minipage}
\end{center}

%%
%%  parameter
%%  

\subsection{\indexTag{<parameter>}}

A \tag{<parameter>} defines an input parameter for a rule.  Each input
parameter will be supplied an object from the working memory in order
to attempt satisfying the conditions.  Each \tag{<parameter>} is
required to have an \texttt{identifier} that is unique within the rule and a
semantic object type as its child element.

\begin{tagDesc}{parameter}
\attrs
  \attr{identifier}{Parameter identifier.}
\tags
  \abstractChildTag{objectType}{Object type of the parameter.}
\end{tagDesc}

\begin{center}
\begin{minipage}{0.8\textwidth}
\begin{tagExample}
<rule name="My First Rule">

    \color{black}{<parameter identifier="factOne">}
        ...
    \color{black}{</parameter>}
    \color{black}{<parameter identifier="factTwo">}
        ...
    \color{black}{</parameter>}

</rule>
\end{tagExample}
\end{minipage}
\end{center}

%%
%%  declaration
%%

\subsection{\indexTag{<declaration>}}

A \tag{<declaration>} defines an addition \emph{local} declared fact
which may be the target of an \emph{extractor}. Its
\texttt{identifier} must be unique across all \tag{<parameter>} and
\tag{<declaration>} tags.  As with a \tag{<parameter>}, it must have
a semantic object type as its child element.

\begin{tagDesc}{declaration}
\attrs
  \attr{identifier}{Declaration identifier.}
\tags
  \abstractChildTag{objectType}{Object type of the local declaration.}
\end{tagDesc}

\begin{center}
\begin{minipage}{0.8\textwidth}
\begin{tagExample}
<rule name="My First Rule">

    \color{black}{<declaration identifier="factOne">}
        ...
    \color{black}{</declaration>}
    \color{black}{<declaration identifier="factTwo">}
        ...
    \color{black}{</declaration>}

</rule>
\end{tagExample}
\end{minipage}
\end{center}

%%
%%  duration
%%

\subsection{\indexTag{<duration>}}

The \tag{<duration>} tag is optionally used to specify the truthness
duration of the rule.  The truthness duration determines how long
the rule's conditions must be \emph{continually} true in order
to activate the rule.

\begin{tagDesc}{duration}
\attrs
  \attr{weeks}{Number of weeks.}
  \attr{days}{Number of days.}
  \attr{hours}{Number of hours.}
  \attr{minutes}{Number of minutes.}
  \attr{seconds}{Number of seconds.}
\end{tagDesc}

\begin{center}
\begin{minipage}{0.8\textwidth}
\begin{tagExample}
<rule name="My First Rule">

    \color{black}{<duration hours="2"}
              \color{black}{minutes="30"/>}

</rule>
\end{tagExample}
\end{minipage}
\end{center}
